// ============================================================================
// LoveAlways - Spreadtrum Exploit Type Definitions
// Support: BSL Protocol Vulnerabilities, FDL Signature Bypass, Memory Read, Downgrade Attack
// ============================================================================
// ⚠️ Warning: For legal purposes only (recovering own devices, security research)
// ============================================================================

// ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
// Eng Translation by iReverse - HadiKIT - Hadi Khoirudin, S.Kom.
// ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++


using System;
using System.Collections.Generic;

namespace LoveAlways.Spreadtrum.Exploit
{
    /// <summary>
    /// Spreadtrum exploit types
    /// </summary>
    public enum SprdExploitType
    {
        None,
        BslOverflow,            // BSL protocol overflow
        FdlSignatureBypass,     // FDL signature bypass
        MemoryRead,             // Memory read vulnerability
        Downgrade,              // Downgrade attack
        DowngradeAttack,        // Downgrade attack (alias)
        HdlcOverflow,           // HDLC frame overflow
        NvBypass,               // NV verification bypass
        NvUnlock,               // NV area unlock
        SecureBootBypass,       // Secure Boot bypass
        DebugMode               // Debug mode activation
    }

    /// <summary>
    /// Exploit result
    /// </summary>
    public class SprdExploitResult
    {
        public bool Success { get; set; }
        public SprdExploitType UsedExploit { get; set; }
        public string Message { get; set; }
        public byte[] ExtractedData { get; set; }
        public Dictionary<string, object> ExtraInfo { get; set; }

        public SprdExploitResult()
        {
            ExtraInfo = new Dictionary<string, object>();
        }
    }

    /// <summary>
    /// Vulnerability information
    /// </summary>
    public class SprdVulnerabilityInfo
    {
        public SprdExploitType Type { get; set; }
        public string Name { get; set; }
        public string Description { get; set; }
        public string CVE { get; set; }
        public int SuccessRate { get; set; }  // 1-5 stars
        public bool RequiresRoot { get; set; }
        public string[] AffectedChips { get; set; }
        public string[] AffectedVersions { get; set; }
    }

    /// <summary>
    /// Vulnerability check result
    /// </summary>
    public class SprdVulnerabilityCheckResult
    {
        public bool HasVulnerability { get; set; }
        public string Reason { get; set; }
        public SprdExploitType RecommendedExploit { get; set; }
        public List<SprdVulnerabilityInfo> AvailableExploits { get; set; }
        public bool IsUnfused { get; set; }
        public uint ChipId { get; set; }
        public string PkHash { get; set; }

        public SprdVulnerabilityCheckResult()
        {
            AvailableExploits = new List<SprdVulnerabilityInfo>();
        }
    }

    /// <summary>
    /// Spreadtrum device security information
    /// </summary>
    public class SprdSecureBootInfo
    {
        public bool IsSecureBootEnabled { get; set; }
        public bool IsEfuseLocked { get; set; }
        public bool IsAntiRollbackEnabled { get; set; }
        public uint SecurityVersion { get; set; }
        public string PublicKeyHash { get; set; }
        public byte[] RawEfuseData { get; set; }
    }

    /// <summary>
    /// Bootloader status information
    /// </summary>
    public class SprdBootloaderStatus
    {
        /// <summary>Is unlocked</summary>
        public bool IsUnlocked { get; set; }
        
        /// <summary>Is Unfused device</summary>
        public bool IsUnfused { get; set; }
        
        /// <summary>Is Secure Boot enabled</summary>
        public bool IsSecureBootEnabled { get; set; }
        
        /// <summary>Security version number</summary>
        public uint SecurityVersion { get; set; }
        
        /// <summary>Device model</summary>
        public string DeviceModel { get; set; }
        
        /// <summary>Required unlock type</summary>
        public SprdUnlockType RequiredUnlockType { get; set; }
        
        /// <summary>Manufacturer</summary>
        public string Manufacturer { get; set; }
    }

    /// <summary>
    /// Unlock type
    /// </summary>
    public enum SprdUnlockType
    {
        /// <summary>No unlock required</summary>
        None,
        /// <summary>Unlock using exploit (Unfused)</summary>
        Exploit,
        /// <summary>Requires manufacturer unlock code</summary>
        OemCode,
        /// <summary>Unlock not supported</summary>
        NotSupported
    }
}
